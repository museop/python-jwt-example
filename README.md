# JWT Token

> 본 문서는 ChatGPT의 도움을 받아 작성되었습니다.

JWT (JSON Web Token)은 인증과 정보의 안전한 교환을 위해 널리 사용되는 개방형 표준 (RFC 7519)입니다. 일반적으로 웹 애플리케이션의 인증 메커니즘으로 활용되며, 서버와 클라이언트 사이에 데이터를 안전하게 전송하는 데 사용됩니다.


## JWT의 구조

JWT는 세 부분으로 구성된 문자열입니다: 헤더(Header), 페이로드(Payload), 서명(Signature). 각 부분은 점 (.)으로 구분되며, 각각의 역할은 다음과 같습니다:

헤더 (Header): 토큰의 타입 (JWT)과 해싱 알고리즘 (예: HMAC SHA256)을 정의합니다.

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```
페이로드 (Payload): 토큰에 포함될 클레임 (Claim)을 나타냅니다. 클레임은 사용자 정보나 토큰에 대한 메타 데이터를 나타낼 수 있습니다. JWT는 표준 클레임 (예: iss, exp, sub)뿐만 아니라 사용자 정의 클레임도 포함할 수 있습니다.

```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true
}
```

서명 (Signature): 서명은 헤더와 페이로드를 결합하고 주어진 비밀 키로 암호화하여 생성됩니다. 이는 JWT의 무결성을 보장하며, 토큰이 변조되지 않았음을 검증하는 데 사용됩니다.

```
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret
)
```

## 주요 표준 클레임
`iss` (Issuer):

- 용도: 이 클레임은 JWT를 발행한 주체, 즉 발행자(issuer)를 나타냅니다. 보통 발행자의 고유 식별자(예: 도메인 이름)가 사용됩니다.
- 예시: "iss": "https://yourapp.com"
- 설명: 서버가 여러 발행자로부터 JWT를 받을 수 있는 경우, iss 클레임을 통해 어떤 서버가 토큰을 발급했는지 식별할 수 있습니다. 토큰의 신뢰성을 확인하는 데 사용됩니다.

`sub` (Subject):

- 용도: 이 클레임은 JWT의 주체(subject)를 나타냅니다. 주체는 보통 사용자의 고유 식별자를 의미하며, 해당 토큰이 특정 사용자에게 발급되었음을 알 수 있습니다.
- 예시: "sub": "1234567890"
- 설명: 사용자 인증 과정에서, 토큰이 특정 사용자에 대한 것임을 식별하는 데 사용됩니다. 이 클레임은 사용자 아이디(ID)처럼 고유하게 사용자 또는 엔티티를 식별할 수 있는 값이 들어갑니다.

`exp` (Expiration Time):

- 용도: 이 클레임은 JWT의 만료 시각을 나타내며, 토큰의 유효 기간을 지정합니다.
- 예시: "exp": 1717171717 (유닉스 타임스탬프 형식으로 지정)
- 설명: exp 클레임을 통해 토큰이 유효한 시간 범위를 설정할 수 있습니다. 만료 시간이 지나면 토큰은 더 이상 유효하지 않으며, 서버는 토큰이 만료되었음을 검증하여 요청을 거절합니다. 이를 통해 보안을 유지하고, 토큰 탈취 등으로 인한 문제를 줄일 수 있습니다.

`iat` (Issued At):

- 용도: JWT가 발행된 시간을 나타냅니다.
- 예시: "iat": 1717171717
- 설명: 이 클레임은 토큰이 언제 발행되었는지를 알 수 있게 해주며, 이를 통해 토큰의 나이 또는 유효성을 확인할 수 있습니다.

`aud` (Audience):

- 용도: 이 클레임은 JWT의 수신 대상(audience)을 나타냅니다. 이 클레임을 통해 특정 수신자만 토큰을 신뢰하도록 제한할 수 있습니다.
- 예시: "aud": "https://myapi.com"
- 설명: 서버는 요청을 처리하기 전에 토큰의 aud 값이 자신과 일치하는지 확인하여, 자신의 서비스에 대한 토큰인지 검증합니다.

`nbf` (Not Before):

- 용도: 이 클레임은 특정 시간 이전에는 JWT를 사용할 수 없음을 나타냅니다.
- 예시: "nbf": 1717171717
- 설명: nbf는 토큰이 유효하게 사용될 수 있는 시작 시점을 나타냅니다. 특정 시간 이전에는 토큰이 무효함을 보장합니다.

`jti` (JWT ID):

- 용도: JWT의 고유 식별자를 나타냅니다.
- 예시: "jti": "unique-token-id"
- 설명: 서버가 발행한 각 토큰에 대해 고유한 식별자를 부여하기 위한 용도로 사용됩니다. 이 값은 토큰을 추적하거나, 혹은 발급된 후 무효화(blacklist)해야 하는 경우에 유용하게 사용할 수 있습니다.

## JWT 클레임 사용 예시
- `exp`와 `iat`의 조합: 토큰이 언제 발행되었으며, 언제 만료될지를 지정함으로써 서버가 해당 토큰이 너무 오래된 것인지, 또는 아직 유효한지 쉽게 판단할 수 있습니다.
- `iss`와 `aud`의 조합: 서버가 여러 클라이언트 또는 제휴된 서비스와 통신하는 경우, `iss`와 `aud` 클레임을 활용하여 발행자와 수신자가 적합한지 확인하고 보안을 강화할 수 있습니다.
- `sub`: 사용자의 고유한 식별자 정보가 필요할 때 sub를 통해 해당 사용자를 특정할 수 있으며, 이 정보는 주로 인증된 요청에서 특정 사용자를 구별하는 데 유용합니다.

## JWT의 장점

자체 포함(Self-contained): JWT는 필요한 정보를 모두 토큰 안에 포함하고 있어, 서버가 별도의 상태를 유지하지 않아도 됩니다.
- 확장성: 토큰이 클라이언트에 저장되므로 서버의 확장성 문제를 해결하는 데 유리합니다.
- 안전한 정보 전송: 서명된 JWT는 데이터의 무결성을 보장하며, 발급자가 변경되지 않았는지 확인할 수 있습니다.

## JWT의 단점

- 크기: JWT는 기본적으로 Base64로 인코딩되기 때문에 일반적인 세션 쿠키보다 크기가 큽니다.
- 토큰 만료 관리: 토큰을 무효화하는 것이 어렵습니다. 예를 들어, 사용자가 로그아웃할 경우 JWT는 여전히 유효하며 서버가 이를 강제로 무효화하기 어렵습니다.

## JWT 사용 시 주의점
- 비밀 키 보호: 서명에 사용되는 비밀 키는 안전하게 보호되어야 하며, 노출 시 토큰을 쉽게 위조할 수 있습니다.
- 짧은 만료 시간 설정: 보안을 위해 토큰의 만료 시간을 짧게 설정하고, 필요시 갱신하는 방법을 사용하는 것이 좋습니다.
- HTTPS 사용: 민감한 정보를 JWT 페이로드에 포함할 경우 HTTPS를 사용하여 토큰이 전송되는 과정에서 탈취되지 않도록 해야 합니다.

## 대칭 키 방식 vs. 비대칭 키 식

### 대칭 키 방식 (HMAC)
대칭 키 방식은 동일한 비밀 키를 사용하여 JWT를 생성하고 검증하는 방식입니다. 대표적인 알고리즘으로는 HMAC-SHA256을 사용합니다. 즉, 토큰을 생성하는 서비스와 이를 검증하는 서비스가 동일한 비밀 키를 사용해야만 JWT의 유효성을 검증할 수 있습니다.

이 방식에는 몇 가지 보안 이슈가 존재합니다:

- 키 공유: JWT를 발행하는 서비스와 검증하는 서비스가 모두 동일한 키를 공유해야 합니다. 이 키가 노출되면 공격자는 토큰을 위조할 수 있기 때문에 보안에 매우 취약합니다.
- 키 관리 어려움: 키를 사용하는 서비스가 많아질수록, 키를 안전하게 유지하고, 필요시 키를 변경하는 작업이 복잡해집니다.

### 비대칭 키 방식 (RSA 또는 ECDSA)
이 문제를 해결하기 위해 비대칭 키 암호화 방식을 사용할 수 있습니다. 비대칭 키 방식은 **개인 키(private key)**와 공개 키(public key) 두 가지 키를 사용하며, RSA 또는 ECDSA 알고리즘을 활용합니다.

- 개인 키 (Private Key): JWT를 발행할 때 사용됩니다. 이 개인 키는 발행 서비스에만 저장되어 있어야 합니다.
- 공개 키 (Public Key): JWT를 검증할 때 사용됩니다. 공개 키는 누구나 접근할 수 있도록 제공될 수 있으며, 검증 서비스가 이를 사용하여 JWT의 유효성을 확인합니다.

비대칭 키 방식의 장점은 다음과 같습니다:

- 보안성: 개인 키는 발행 서비스에서만 사용되기 때문에 노출 위험이 줄어듭니다. 검증을 위해 사용하는 공개 키는 공개적으로 배포할 수 있으므로 보안 리스크가 적습니다.
- 키 공유 문제 해결: 여러 서비스가 JWT를 검증해야 할 때, 공개 키만을 배포하면 되므로 키 관리가 훨씬 간단하고 보안성이 강화됩니다.

## 예제 코드

- `hmac-based.py`: 대칭 키를 이용한 JWT 키 생성 및 검증 예제
- `rsa-key-generation.py`: 비대칭 키 생성(`private_key.pem`, `public_key.pem`) 예제
- `rsa-based.py`: 비대칭 키를 이용한 JWT 키 생성 및 검증 예제 